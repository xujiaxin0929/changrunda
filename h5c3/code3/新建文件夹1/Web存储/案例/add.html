<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>学生档案</title>
	<style>
		body {
			margin: 0;
			padding: 0 0 40px;
			background-color: #F7F7F7;
			font-family: '微软雅黑';
		}

		form {
			max-width: 640px;
			width: 100%;
			margin: 24px auto;
			font-size: 28px;
		}

		label {
			display: block;
			margin: 10px 10px 15px;
			font-size: 24px;
		}

		input {
			display: block;
			width: 100%;
			height: 40px;
			font-size: 22px;
			margin-top: 10px;
			padding: 6px 10px;
			color: #333;
			border: 1px solid #CCC;
			box-sizing: border-box;
		}

		.btn {
			margin-top: 30px;
		}

		.btn input {
			color: #FFF;
			background-color: green;
			border: 0 none;
			outline: none;
			cursor: pointer;
		}

		input[type="file"] {
			/*opacity: 0;*/
			width: 120px;
			position: absolute;
			right: 0;
			z-index: 9;
		}

		.import {
			height: 40px;
			position: relative;
		}

	</style>
</head>
<body>
	<form action="">
		<fieldset>
			<legend>学生档案</legend>
			<label >
				姓名: <input type="text" name="name" autofocus placeholder="请输入姓名">
			</label>
			<label >
				性别: <input type="text" name="sex" autofocus placeholder="请输入性别">
			</label>
			<label >
				年龄: <input type="text" name="age" autofocus placeholder="请输入年龄">
			</label>
			<label >
				手机号码: <input type="tel" name="phone" placeholder="请输入手机号码">
			</label>
			<label >
				邮箱地址: <input type="email" name="email" placeholder="请输入邮箱地址">
			</label>
			<label >
				所属学院: <input type="text" name="subject" list="course" placeholder="前端与移动开发学院">
				<datalist id="course">
					<option value="前端与移动开发"></option>
					<option value="PHP"></option>
					<option value="JAVA"></option>
					<option value="Android"></option>
					<option value="IOS"></option>
					<option value="UI设计"></option>
					<option value="C++"></option>
				</datalist>
			</label>
			<label >
				入学成绩: <input type="number" name="score" max="100" id="score" step="10" value="80">
			</label>
			<label >
				入学日期: <input type="date" name="date_start" value="2016-01-01">
			</label>
			<label >
				毕业时间: <input type="date" name="date_end" value="2016-05-01">
			</label>
			<label  class="btn">
				<input type="button" value="保存">
			</label>
			<label  class="import">
				<input type="file">
			</label>
		</fieldset>
	</form>
	<script src="./js/jquery.min.js"></script>
	<script type="text/javascript">

		// 1、通过上传文件的方式，把本地文件的内容保存起来

		// 1.1、给type类型是file的input标签绑定事件
		$(".import input").on("change",function(){
			// 1.2、获取文件列表
			var fl = $(this)[0].files;

			// 1.3、定义一个读取器
			var reader = new FileReader();

			// 1.4、以文本的方式读取文件
			reader.readAsText(fl[0]);

			// 1.5、完全加载后处理数据
			reader.onload=function(){
				// 1.6、返回数据结果
				var res = reader.result;
//				console.log(res);

				// 保存到 localStorage
				// localStorage.setItem("list",res);


				// 1.7、保存数据前应该判断本地是否已经有数据
				// 1.7.1、从本地存储中取出数据
				var list = localStorage.getItem("list");
				// 1.7.2、对数据进行转换
				// 用了一个技巧既可以判断本地是否有数据同时也可以把本地数据进行转换
				list  = list && JSON.parse(list);
				
				if(list){
					// 1.7.3、如果不为空，需要在原有数据上追加数据
					// 1.7.3.1、先将读取出的文件转换成对象
					res = JSON.parse(res);
					// 1.7.3.2、通过循环的方式一个个的插入到本地已有的数据中
					$.each(res,function(i,obj){
						list.push(obj);
					})
					// 1.7.3.3、然后将新数据存储到本地
					localStorage.setItem("list",JSON.stringify(list));
				}
				else{
					// 1.7.4、如果为空 直接存储到本地
					localStorage.setItem("list",res);
				}

			}
		})

		// 2、单独保存数据
		$(".btn input").on("click",function(){
			// 2.1、获取表单数据
			// jquery的serializeArray()方法
			// 主要是获取表单中的数据
			// 好处是批量获取同时直接转换成数组
			var data = $("form").serializeArray();
			//console.log(data);

			// 2.2、将表单里的数据组织一下，使其符合存储的格式
			// 2.2.1、定义一个空的对象
			var temp = {};
			// 2.2.2、通过循环的方式组织成json格式的数据
			$.each(data,function(i,obj){
				console.log(obj);
				temp[obj.name] = obj.value;
			});
			console.log(temp);

			// 2.3、保存数据
			// 2.3.1、判断是否已经存储了数据
			// 2.3.1.1、从本地拿出数据
			var list = localStorage.getItem("list");

			list = list && JSON.parse(list);
			console.log(list);
			// 2.3.1.2、如果有数据
			if(list)
			{
				// 2.3.1.2.1、如果有数据将组织好的表单数据添加到已有的数据中
				list.push(temp);
				// 2.3.1.2.2、保存前转换成字符串
				list = JSON.stringify(list);
				console.log(list);
				// 2.3.1.2.3、保存数据
				localStorage.setItem("list",list);
			}
			else{
				// 2.3.1.3、如果没有
				// 2.3.1.3.1、将json数据放到数组中
				temp = [temp];
				// 2.3.1.3.2、保存数据
				localStorage.setItem("list",JSON.stringify(temp));
			}


		})

	</script>
</body>
</html>